{% extends "base.html" %}

{% block title %}المؤلفون - غرناطة{% endblock %}

{% block content %}
<div class="container" x-data="authorsPage()">
    <!-- Search -->
    <div class="search-input-cont" style="margin-top: 2rem; margin-bottom: var(--spacing-lg);">
        <input type="text" placeholder="ابحث عن مؤلف..." x-model="search" @input="filterAuthors()">
    </div>

    <!-- Count -->
    <div class="results-count" x-show="filteredAuthors.length > 0">
        <span x-text="filteredAuthors.length + ' مؤلف'"></span>
    </div>

    <!-- Loading State -->
    <div class="loading" x-show="isLoading">
        <div class="loading-spinner"></div>
    </div>

    <!-- Authors List -->
    <div x-show="!isLoading && filteredAuthors.length > 0">
        <template x-for="author in filteredAuthors" :key="author.id">
            <a :href="'/authors/' + author.id" class="author-item">
                <div class="author-name">
                    <span x-text="author.name"></span>
                    <span class="author-death" x-text="'(ت ' + author.death_date + ' هـ)'"></span>
                </div>
                <span class="author-book-count" x-text="'(' + author.book_count + ')'"></span>
            </a>
        </template>
    </div>

    <!-- Empty State -->
    <div class="empty-state" x-show="!isLoading && filteredAuthors.length === 0">
        <div class="empty-state-icon">&#128100;</div>
        <div class="empty-state-text">لم يتم العثور على مؤلفين</div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function authorsPage() {
    return {
        authors: [],
        filteredAuthors: [],
        search: '',
        isLoading: true,

        init() {
            this.loadAuthors();
        },

        async loadAuthors() {
            this.isLoading = true;
            try {
                const response = await fetch('/api/authors');
                const data = await response.json();
                this.authors = data.authors || [];
                // Sort by death date (oldest first)
                this.authors.sort((a, b) => a.death_date - b.death_date);
                this.filteredAuthors = [...this.authors];
            } catch (error) {
                console.error('Failed to load authors:', error);
            } finally {
                this.isLoading = false;
            }
        },

        filterAuthors() {
            if (!this.search) {
                this.filteredAuthors = [...this.authors];
                return;
            }
            this.filteredAuthors = this.authors.filter(a =>
                a.name.includes(this.search)
            );
        }
    };
}
</script>
{% endblock %}
